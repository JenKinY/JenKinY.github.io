<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Android集成BmobSDK之自动更新</title>
      <link href="/2019/04/05/android-ji-cheng-bmobsdk-zhi-zi-dong-geng-xin/"/>
      <url>/2019/04/05/android-ji-cheng-bmobsdk-zhi-zi-dong-geng-xin/</url>
      
        <content type="html"><![CDATA[<p>说明：</p><p>​    AndroidStudio:V3.3.2</p><p>​    targetSdkVersion:28</p><p>​    BmobSDK:V3.7.2</p><p>​    官方文档：<a href="http://doc.bmob.cn/data/android/auto_update/" target="_blank" rel="noopener">Bmob文档中心-自动更新</a></p><h3 id="1、添加资源文件"><a href="#1、添加资源文件" class="headerlink" title="1、添加资源文件"></a>1、添加资源文件</h3><p>下载SDK提供的res文件夹拷入工程目录下，和工程本身res目录合并。</p><p><a href="https://www.bmob.cn/static/res.zip" target="_blank" rel="noopener">BmobSDK自动更新所需资源文件</a></p><p>这里需要注意的是：</p><ol><li>请不要随便删除其中的文件。</li><li>BmobSDK提供的资源文件都以bmob_开头。</li><li><code>如果是在AndroidStudio中用远程依赖的方式就可以跳过这个步骤，因为这些资源都在下载到本地的aar包中。</code></li></ol><h3 id="2、配置AndroidManifest-xml"><a href="#2、配置AndroidManifest-xml" class="headerlink" title="2、配置AndroidManifest.xml"></a>2、配置AndroidManifest.xml</h3><ol><li><p>打开AndroidManifest.xml,添加SDK所需权限：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 允许将下载的apk保存到sd卡中 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!-- 允许检查网络状态，从而根据不同网络环境决定何种下载策略,务必添加该权限 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.ACCESS_NETWORK_STATE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!-- 联网权限 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment" spellcheck="true">&lt;!-- 适配Android8.0的安装权限管理 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.REQUEST_INSTALL_PACKAGES<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>说明：<code>（ps: Android6.0以上要动态处理该权限，不然会造成更新过程中下载失败！！）</code></p></li><li><p>添加渠道到标签下:(可选，这一步由于我不需要就没配置)</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Channel ID<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>BMOB_CHANNEL<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>说明：</p><ul><li><code>BMOB_CHANNEL</code>用来标注应用推广渠道，不同渠道可以上传不同更新包，您可以使用20位以内的英文和数字为渠道定名，替换value中的<code>Channel ID</code>。如果不添加，将不区分渠道。<code>(注意不要出现在manifest中标识了渠道但后端控制台没写渠道值，这样是无法自动更新的，因为没匹配上)</code></li></ul></li><li><p>添加Activity到标签下：</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>             <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cn.bmob.v3.update.UpdateDialogActivity<span class="token punctuation">"</span></span>            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:style/Theme.Translucent.NoTitleBar<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="3-初始化AppVersion表"><a href="#3-初始化AppVersion表" class="headerlink" title="3. 初始化AppVersion表"></a>3. 初始化AppVersion表</h3><p>​    在调试程序入口添加此语句，可自动在后台生成 <code>AppVersion</code>表:</p><pre class="line-numbers language-java"><code class="language-java">    BmobUpdateAgent<span class="token punctuation">.</span><span class="token function">initAppVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>使用此语句在后台生成AppVersion后应删除此语句，否则可能会在后台重复创建此表</code>**</p><p>​    <strong>ps:</strong></p><p>​        <strong> 若执行此语句后，在后台并未发现生成AppVersion表，可以尝试清除该应用数据，并再次打开 ，若还是无法生成可以手动创建此表，不过要注意个字段一定不要填错，具体字段可以跳到下面第5步查看或者查询<a href="http://doc.bmob.cn/data/android/auto_update/#5apkapkurl" target="_blank" rel="noopener">官方文档-AppVersion各字段说明</a></strong></p><h3 id="4、调用自动更新接口"><a href="#4、调用自动更新接口" class="headerlink" title="4、调用自动更新接口"></a>4、调用自动更新接口</h3><p>最常见的自动更新模式是：当用户进入应用首页后，如果处于wifi环境则检测更新，如果有更新，弹出对话框提示有新版本，用户点选更新开始下载更新。实现的方法是，在应用程序入口Activity里的<code>OnCreate()</code>方法中调用如下代码：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>Bundle  savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>    BmobUpdateAgent<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol><li>默认只在WiFi下才进行自动更新提醒。我们要在任意网络环境下都进行更新自动提醒，则请在update调用之前添加以下代码：</li></ol><pre class="line-numbers language-java"><code class="language-java">BmobUpdateAgent<span class="token punctuation">.</span><span class="token function">setUpdateOnlyWifi</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>如果你发现调用update方法无反应，可使用下面<code>自定义功能</code>中的<code>监听检测更新的结果</code>提到的方法来监听自动更新的结果,具体如下：</li></ol><pre class="line-numbers language-java"><code class="language-java">BmobUpdateAgent<span class="token punctuation">.</span><span class="token function">setUpdateListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BmobUpdateListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpdateReturned</span><span class="token punctuation">(</span><span class="token keyword">int</span> updateStatus<span class="token punctuation">,</span> UpdateResponse updateInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>        <span class="token comment" spellcheck="true">//根据updateStatus来判断更新是否成功</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="强制更新"><a href="#强制更新" class="headerlink" title="强制更新"></a>强制更新</h4><p>应用场景：如果应用需要屏蔽旧版本，强制用户必须更新升级到最新版才能继续使用。</p><p>SDK中为自动更新方式提供了<code>强制更新</code>功能，当开发者开启强制更新功能（即将后台的<code>AppVersion</code>表中的isforce字段置为true）时，客户端调用<code>BmobUpdateAgent.update(context)</code>方法后，更新对话框只保留“立即更新”按钮且不再支持回退操作。</p><h4 id="忽略版本更新"><a href="#忽略版本更新" class="headerlink" title="忽略版本更新"></a>忽略版本更新</h4><p>SDK中为自动更新方式提供了<code>忽略版本更新</code>功能，当用户勾选”忽略该版“选项时，再次调用<code>BmobUpdateAgent.update(context)</code>则不再出现版本更新对话框。</p><p><strong>注：强制更新和忽略版本更新只支持自动更新方式。</strong></p><h3 id="5、上传APK文件或填写apk文件的url地址"><a href="#5、上传APK文件或填写apk文件的url地址" class="headerlink" title="5、上传APK文件或填写apk文件的url地址"></a>5、上传APK文件或填写apk文件的url地址</h3><p>初始化AppVersion表成功后，开发者在管理后台的<code>数据浏览</code>页中就可以看见AppVersion表了：</p><p><img src="http://skyzc.oss-cn-shenzhen.aliyuncs.com/MyBlog/Bmob%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/BmobAppVersion%E8%A1%A8.png" alt="AppVersion表"></p><p>新建的表没有数据的，表中个字段如下图：</p><p><img src="http://skyzc.oss-cn-shenzhen.aliyuncs.com/MyBlog/Bmob%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/AppVersion%E5%90%84%E5%AD%97%E6%AE%B5.png" alt="AppVersion各字段"></p><p>我们只关注上图中框选的字段即可，其中：</p><ul><li><p><code>target_size</code> 需要填写我们安装包的实际占用字节(Windows下右键程序包&gt;属性&gt;大小，注意不是占用大小)，填入数值即可，不用添加单位</p><p><img src="http://skyzc.oss-cn-shenzhen.aliyuncs.com/MyBlog/Bmob%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/APKSize.png" alt="target_size"></p></li><li><p><code>version_i</code> 对应我们项目的 <em>versionCode</em>若要更新，我们的更新包的<code>version_i</code> 值就要大于旧版本的<em>versionCode</em>的值</p></li><li><p><code>path</code> 和 <code>android_url</code> 可以二选一，两者都有的话默认优先选择 <code>android_url</code> </p></li></ul><h3 id="6、集成检测"><a href="#6、集成检测" class="headerlink" title="6、集成检测"></a>6、集成检测</h3><p>SDK中默认开启了集成检测功能，在调用任意的更新接口后，我们将替您自动检查上述集成过程中2、3两个步骤是否被正确完成。 如果正确完成不会出现任何提示，否则会以如下的toast提示您。</p><p>你可以通过调用<code>BmobUpdateAgent.setUpdateCheckConfig(false)</code>来禁用此功能。</p><p>toast的含义如下：</p><pre class="line-numbers language-xml"><code class="language-xml">"Please copy all resources (res/) from SDK to your project!"：请检查是不是把res文件夹下所有的资源文件都放到了工程中。"Please add Permission in AndroidManifest!"：请检查上述步骤中的相关权限是否正确添加。"Please add Activity in AndroidManifest!"：请检查上述步骤中的Activity是否正确添加。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7、兼容Android7-0"><a href="#7、兼容Android7-0" class="headerlink" title="7、兼容Android7.0"></a>7、兼容Android7.0</h3><p>兼容了Android7.0中的FileProvider，具体用法如下：</p><ol><li><h5 id="在AndroidManifest-xml中的Application标签下添加如下内容"><a href="#在AndroidManifest-xml中的Application标签下添加如下内容" class="headerlink" title="在AndroidManifest.xml中的Application标签下添加如下内容:"></a>在AndroidManifest.xml中的Application标签下添加如下内容:</h5><pre><code>&lt;provider    android:name=&quot;android.support.v4.content.FileProvider&quot;    android:authorities=&quot;此处填写你应用的包名&quot;    android:exported=&quot;false&quot;    android:grantUriPermissions=&quot;true&quot;&gt;    &lt;meta-data        android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;        android:resource=&quot;@xml/file_paths&quot; /&gt;&lt;/provider&gt;</code></pre></li></ol><ol start="2"><li><h5 id="在res的xml目录下创建file-paths-xml文件，用来指定Apk文件下载的位置："><a href="#在res的xml目录下创建file-paths-xml文件，用来指定Apk文件下载的位置：" class="headerlink" title="在res的xml目录下创建file_paths.xml文件，用来指定Apk文件下载的位置："></a>在res的xml目录下创建file_paths.xml文件，用来指定Apk文件下载的位置：</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;paths&gt;    &lt;external-path name=&quot;Download&quot; path=&quot;Download&quot;/&gt;&lt;/paths&gt;</code></pre></li></ol><h3 id="8、其他更新方式"><a href="#8、其他更新方式" class="headerlink" title="8、其他更新方式"></a>8、其他更新方式</h3><p>​    除了在快速入门中提到的自动更新之外，Bmob自动更新SDK还支持另外两种场景：手动更新、静默更新。还提供很多自定义功能，本文只记录 自动更新-强制更新的方式，更多的详见<a href="http://doc.bmob.cn/data/android/auto_update/" target="_blank" rel="noopener">Bmob官方文档-自动更新</a></p><h3 id="9、所遇到的问题"><a href="#9、所遇到的问题" class="headerlink" title="9、所遇到的问题"></a>9、所遇到的问题</h3><p>按照官方文档进行上面的一番操作后，本应该相安无事，但是生活有时候总是要捉弄一下你</p><p>，代码也是，下面简述一下在集成自动更新时间所遇到的几个问题：</p><h4 id="1-配置完成后，进入页面闪退，并报错："><a href="#1-配置完成后，进入页面闪退，并报错：" class="headerlink" title="1.配置完成后，进入页面闪退，并报错："></a>1.配置完成后，进入页面闪退，并报错：</h4><p><img src="http://skyzc.oss-cn-shenzhen.aliyuncs.com/MyBlog/Bmob%E8%87%AA%E5%8A%A8%E6%9B%B4%E6%96%B0/%E6%9B%B4%E6%96%B0%E5%87%BA%E9%94%99.png" alt="更新报错"></p><p>当时非常遗憾，在网上查询了一番也没找到到底是什么错，最后在官方用户群里了解到，只需要将我们的项目库升级成androidx即可，具体原因没有继续深入研究。</p><p>升级 <code>support</code> 到 <code>androidx</code>：AndroidStudio 3.2 以上添加了一件迁移功能: <code>Refactor</code> -&gt; <code>Migrate to AndroidX</code>,会提示你备份，一点要备份，万一翻车就惨了，你会拥有一大屏的红线 =_=</p><h4 id="2-点击更新按钮，但是下载失败："><a href="#2-点击更新按钮，但是下载失败：" class="headerlink" title="2.点击更新按钮，但是下载失败："></a>2.点击更新按钮，但是下载失败：</h4><p>​    多机型(真机)测试后，发现部分手机可以，部分手机失败，检查了一番推理应该是权限问题。就想到了是储存权限</p><pre class="line-numbers language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!-- 允许将下载的apk保存到sd卡中 --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>应该作动态权限处理</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> BmobSDK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot Learn01</title>
      <link href="/2019/04/03/springboot-learn01/"/>
      <url>/2019/04/03/springboot-learn01/</url>
      
        <content type="html"><![CDATA[<p>​    </p><h2 id="编写过程"><a href="#编写过程" class="headerlink" title="编写过程"></a>编写过程</h2><p>Entity 实体层=&gt;Dao层=&gt;Service层=&gt;Controller层</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 18.04安装 Mysql5.7</title>
      <link href="/2019/03/29/ubuntu-install-mysql5.7/"/>
      <url>/2019/03/29/ubuntu-install-mysql5.7/</url>
      
        <content type="html"><![CDATA[<p>出现：ERROR 1045 (28000): Access denied for user ‘root‘@’localhost’ </p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>##1. 输入以下命令进行安装MySQL5.7</p><pre><code>1. sudo apt-get install mysql-server2. apt-get isntall mysql-client3. sudo apt-get install libmysqlclient-dev</code></pre><p>安装过程中会提示设置密码什么的，注意设置了不要忘了，安装完成之后可以使用如下命令来检查是否安装成功：</p><pre><code>sudo netstat -tap | grep mysql</code></pre><p>通过上述命令检查之后，如果看到有mysql 的socket处于 listen 状态则表示安装成功。<br>登陆mysql数据库可以通过如下命令：</p><pre><code>mysql -u root -p</code></pre><p>-u 表示选择登陆的用户名， -p 表示登陆的用户密码，上面命令输入之后会提示输入密码，此时输入密码就可以登录到mysql。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在我安装过程中，并未提示我设置root密码。安装完成后无法登陆，不带密码也无法登录。<br>在安装过程中会设置初始密码</p><pre><code>sudo vim /etc/mysql/debian.cnf</code></pre><p>然后使用其中的</p><pre><code>user = debin-sys-maintpassword = *********</code></pre><p>这个账户登录：</p><pre><code>mysql -u debin-sys-maint -p  ***********</code></pre><p>可以成功登录,然后修改密码：</p><pre><code>1.mysql&gt;update mysql.user set authentication_string=password(&#39;新密码放到这&#39;) where user=&#39;root&#39; and Host = &#39;localhost&#39;;2.mysql&gt;update mysql.user set plugin=&quot;mysql_native_password&quot;;3.mysql&gt;flush privileges;4.mysql&gt;quit5.$sudo service mysql restart</code></pre><p>然后就可以使用你设置的root密码登录root账户</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.linuxidc.com/Linux/2017-05/143864.htm" target="_blank" rel="noopener">Ubuntu 16.04 上安装 MySQL 5.7 教程</a><br><a href="https://blog.csdn.net/weixin_42353109/article/details/81431051" target="_blank" rel="noopener">Ubuntu下MySQL5.7初始密码修改（附：Windows下MySQL8.0.11找出初始密码）</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
